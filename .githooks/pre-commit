#!/bin/sh
# Pre-commit hook for OpenSecret SDK
# Runs checks on the Rust SDK if changes are detected

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if there are changes in the rust directory
if git diff --cached --name-only | grep -q "^rust/"; then
    echo "ğŸ“¦ Rust changes detected, running Rust checks..."
    
    cd rust
    
    echo "ğŸ“ Checking formatting..."
    if ! cargo fmt --all --check; then
        echo "âŒ Format check failed. Run 'cd rust && cargo fmt' to fix."
        exit 1
    fi
    
    echo "ğŸ”§ Running clippy..."
    if ! cargo clippy --all-targets --all-features -- -D warnings; then
        echo "âŒ Clippy check failed. Fix the warnings above."
        exit 1
    fi
    
    echo "âœ… Running cargo check..."
    if ! cargo check --all-features; then
        echo "âŒ Cargo check failed."
        exit 1
    fi
    
    echo "ğŸ§ª Running tests..."
    if ! cargo test --all-features; then
        echo "âŒ Tests failed."
        exit 1
    fi
    
    cd ..
fi

echo "âœ¨ All pre-commit checks passed!"
exit 0