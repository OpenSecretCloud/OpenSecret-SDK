#!/bin/sh
# Pre-commit hook for OpenSecret SDK
# Runs checks on the Rust SDK if changes are detected

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if there are changes in the rust directory
if git diff --cached --name-only | grep -q "^rust/"; then
    echo "ğŸ“¦ Rust changes detected, running Rust checks..."
    
    cd rust
    
    echo "ğŸ“ Checking formatting..."
    cargo fmt --all -- --check
    if [ $? -ne 0 ]; then
        echo "âŒ Format check failed. Run 'cd rust && cargo fmt' to fix."
        exit 1
    fi
    
    echo "ğŸ”§ Running clippy..."
    cargo clippy --all-targets --all-features -- -D warnings
    if [ $? -ne 0 ]; then
        echo "âŒ Clippy check failed. Fix the warnings above."
        exit 1
    fi
    
    echo "âœ… Running cargo check..."
    cargo check --all-features
    if [ $? -ne 0 ]; then
        echo "âŒ Cargo check failed."
        exit 1
    fi
    
    echo "ğŸ§ª Running tests..."
    cargo test --all-features
    if [ $? -ne 0 ]; then
        echo "âŒ Tests failed."
        exit 1
    fi
    
    cd ..
fi

echo "âœ¨ All pre-commit checks passed!"
exit 0